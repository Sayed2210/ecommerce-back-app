
> ecommerce-backend@1.0.0 test
> jest

FAIL src/modules/orders/tests/orders.service.spec.ts (11.96 s)
  ● OrdersService › updateStatus › should update status and save

    BadRequestException: Invalid order status transition

      81 |       // Relaxing mismatch logic or keeping as is.
      82 |       // Keeping check but ensuring types match.
    > 83 |       throw new BadRequestException('Invalid order status transition');
         |             ^
      84 |     }
      85 |
      86 |     order.status = status;

      at OrdersService.updateStatus (modules/orders/services/orders.service.ts:83:13)
      at Object.<anonymous> (modules/orders/tests/orders.service.spec.ts:80:28)

FAIL src/modules/products/tests/categories.service.spec.ts (12.025 s)
  ● CategoriesService › update › should update category

    expect(received).toBe(expected) // Object.is equality

    Expected: {"id": "c1", "name": "New"}
    Received: undefined

      61 |             repository.save.mockResolvedValue(updated as any);
      62 |
    > 63 |             expect(await service.update('c1', { name: 'New' } as any)).toBe(updated);
         |                                                                        ^
      64 |         });
      65 |
      66 |         it('should throw if not found', async () => {

      at Object.<anonymous> (modules/products/tests/categories.service.spec.ts:63:72)

FAIL src/modules/cart/tests/cart.service.spec.ts (12.427 s)
  ● CartService › should be defined

    Nest can't resolve dependencies of the CartService (CartRepository, CartItemRepository, ProductVariantRepository, ProductRepository, RedisService, ?). Please make sure that the argument NotificationsGateway at index [5] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsGateway is a provider, is it part of the current RootTestModule?
    - If NotificationsGateway is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsGateway */ ]
      })

      41 |         };
      42 |
    > 43 |         const module: TestingModule = await Test.createTestingModule({
         |                                       ^
      44 |             providers: [
      45 |                 CartService,
      46 |                 { provide: getRepositoryToken(Cart), useValue: cartRepository },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 5)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/cart/tests/cart.service.spec.ts:43:39)

  ● CartService › getOrCreateCart › should return existing cart for user

    Nest can't resolve dependencies of the CartService (CartRepository, CartItemRepository, ProductVariantRepository, ProductRepository, RedisService, ?). Please make sure that the argument NotificationsGateway at index [5] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsGateway is a provider, is it part of the current RootTestModule?
    - If NotificationsGateway is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsGateway */ ]
      })

      41 |         };
      42 |
    > 43 |         const module: TestingModule = await Test.createTestingModule({
         |                                       ^
      44 |             providers: [
      45 |                 CartService,
      46 |                 { provide: getRepositoryToken(Cart), useValue: cartRepository },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 5)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/cart/tests/cart.service.spec.ts:43:39)

  ● CartService › addItem › should add new item to cart

    Nest can't resolve dependencies of the CartService (CartRepository, CartItemRepository, ProductVariantRepository, ProductRepository, RedisService, ?). Please make sure that the argument NotificationsGateway at index [5] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsGateway is a provider, is it part of the current RootTestModule?
    - If NotificationsGateway is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsGateway */ ]
      })

      41 |         };
      42 |
    > 43 |         const module: TestingModule = await Test.createTestingModule({
         |                                       ^
      44 |             providers: [
      45 |                 CartService,
      46 |                 { provide: getRepositoryToken(Cart), useValue: cartRepository },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 5)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/cart/tests/cart.service.spec.ts:43:39)

  ● CartService › updateItem › should update item quantity

    Nest can't resolve dependencies of the CartService (CartRepository, CartItemRepository, ProductVariantRepository, ProductRepository, RedisService, ?). Please make sure that the argument NotificationsGateway at index [5] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsGateway is a provider, is it part of the current RootTestModule?
    - If NotificationsGateway is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsGateway */ ]
      })

      41 |         };
      42 |
    > 43 |         const module: TestingModule = await Test.createTestingModule({
         |                                       ^
      44 |             providers: [
      45 |                 CartService,
      46 |                 { provide: getRepositoryToken(Cart), useValue: cartRepository },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 5)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/cart/tests/cart.service.spec.ts:43:39)

  ● CartService › removeItem › should delete item

    Nest can't resolve dependencies of the CartService (CartRepository, CartItemRepository, ProductVariantRepository, ProductRepository, RedisService, ?). Please make sure that the argument NotificationsGateway at index [5] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If NotificationsGateway is a provider, is it part of the current RootTestModule?
    - If NotificationsGateway is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing NotificationsGateway */ ]
      })

      41 |         };
      42 |
    > 43 |         const module: TestingModule = await Test.createTestingModule({
         |                                       ^
      44 |             providers: [
      45 |                 CartService,
      46 |                 { provide: getRepositoryToken(Cart), useValue: cartRepository },

      at TestingInjector.lookupComponentInParentModules (../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 5)
      at TestingInjector.resolveConstructorParams (../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (modules/cart/tests/cart.service.spec.ts:43:39)

PASS src/modules/products/tests/products.controller.spec.ts
PASS src/modules/orders/tests/checkout.controller.spec.ts
FAIL src/modules/cart/tests/cart.controller.spec.ts
  ● CartController › getCart › should return cart

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "u1", undefined
    Received: "u1"

    Number of calls: 1

      40 |             // Controller might handle guest carts too, assume user for now or mock headers
      41 |             expect(await controller.getCart(req)).toBe(cart);
    > 42 |             expect(service.getOrCreateCart).toHaveBeenCalledWith('u1', undefined);
         |                                             ^
      43 |         });
      44 |     });
      45 |

      at Object.<anonymous> (modules/cart/tests/cart.controller.spec.ts:42:45)

PASS src/modules/notifications/tests/notification.service.spec.ts
PASS src/modules/auth/tests/auth.controller.spec.ts
PASS src/modules/orders/tests/orders.controller.spec.ts
PASS src/modules/users/tests/wishlist.controller.spec.ts
PASS src/modules/orders/tests/coupons.controller.spec.ts
PASS src/modules/auth/tests/auth.service.spec.ts
PASS src/modules/orders/tests/coupon.service.spec.ts
PASS src/modules/products/tests/products.service.spec.ts
PASS src/modules/users/tests/wishlist.service.spec.ts
PASS src/modules/notifications/tests/websocket.gateway.spec.ts
PASS src/modules/reviews/tests/reviews.service.spec.ts
PASS src/modules/users/tests/users.service.spec.ts
PASS src/app.controller.spec.ts

Test Suites: 4 failed, 15 passed, 19 total
Tests:       8 failed, 93 passed, 101 total
Snapshots:   0 total
Time:        20.571 s
Ran all test suites.
